+++
# --- MDTM Task ---
id = "TASK-DEBUG-20250505-172400"
title = "Debug 'N/A' Values in Dashboard Run Summary"
status = "üü° To Do"
type = "üêû Bug"
created_date = "2025-05-05"
updated_date = "2025-05-05"
assigned_to = "debug"
coordinator = "roo-commander"
priority = "High"
tags = ["dashboard", "frontend", "streamlit", "api", "debug", "bug", "na-values"]
related_docs = ["dashboard_enhanced_v2.py", "reinforcestrategycreator/api/routers/runs.py"]
# --- Bug Report ---
# **Observed Behavior:** The "Run Summary" section in the dashboard (`dashboard_enhanced_v2.py`) displays "N/A" for all metrics (Avg PnL, Avg Sharpe Ratio, Avg Win Rate).
# **Expected Behavior:** The dashboard should display the calculated summary metrics fetched from the API.
# **Context:** Analysis confirmed the backend API endpoint (`/runs/{run_id}/episodes/summary/`) returns valid numeric data when called directly (e.g., via curl). The individual episode details section *does* display data correctly.
# **Hypothesis:** The issue likely lies within the `fetch_api_data` function (called by `fetch_run_summary`) in `dashboard_enhanced_v2.py`. It might be returning `None` due to intermittent request errors, parsing issues, or caching problems (@st.cache_data), causing the `format_metric` function to display "N/A".
# --- Acceptance Criteria ---
# - AC1: The root cause of `fetch_api_data` returning `None` for the summary endpoint is identified.
# - AC2: The "Run Summary" section in the dashboard correctly displays the numeric values for Avg PnL, Avg Sharpe Ratio, and Avg Win Rate fetched from the API.
# - AC3: Appropriate error handling or logging is added if the issue is intermittent or related to API availability.
+++

# Debug 'N/A' Values in Dashboard Run Summary

## 1. Problem Description

The "Run Summary" section of the Streamlit dashboard (`dashboard_enhanced_v2.py`) consistently shows "N/A" for key performance indicators like Average PnL, Average Sharpe Ratio, and Average Win Rate. However, direct calls to the corresponding API endpoint (`/runs/{run_id}/episodes/summary/`) return valid data, and the individual episode details section displays correctly.

## 2. Investigation Steps & Findings (from roo-commander)

1.  **Verified API Endpoint:** Used `curl` to call `/runs/{latest_run_id}/episodes/summary/`. The API returned a valid JSON response with numeric values for all summary metrics.
2.  **Analyzed Frontend Code:**
    *   The dashboard calls `fetch_run_summary(run_id)` (line 1002).
    *   `fetch_run_summary` calls the generic `fetch_api_data(endpoint)` helper (line 85).
    *   `fetch_api_data` (lines 33-73) handles the API call, caching (`@st.cache_data`), and error handling (returns `None` on error).
    *   The display logic uses `format_metric(run_summary.get('metric_name'), type)` (lines 1006-1009).
    *   `format_metric` (lines 878-899) returns "N/A" only if the input value is `None`.
3.  **Conclusion:** The issue is likely within the frontend code. The `fetch_api_data` function, when called for the summary endpoint, is probably returning `None`. This could be due to:
    *   An error occurring *during* the request within the `try...except` block of `fetch_api_data`.
    *   An issue with Streamlit's `@st.cache_data`.
    *   An unexpected parsing failure specific to the summary response within `fetch_api_data`.

## 3. Debugging Plan / Checklist

-   [ ] **Review Logs:** Check the Streamlit application logs for any errors related to the `fetch_api_data` function or the `/runs/.../summary/` endpoint call when the dashboard loads.
-   [‚úÖ] **Add Logging:** Temporarily added detailed logging within `fetch_api_data` (lines 51-66) to log raw response and parsed JSON for the summary endpoint.
-   [‚úÖ] **Test Caching:** Temporarily disabled caching by commenting out `@st.cache_data` on `fetch_api_data` (line 33).
-   [‚úÖ] **Inspect `run_summary`:** Added `st.write(f"DEBUG: run_summary value = {run_summary}")` after line 1002 in `dashboard_enhanced_v2.py`.
-   [ ] **Identify Root Cause:** Determine why `fetch_api_data` returns `None` or incorrect data for the summary call based on logs and debug output.
-   [ ] **Implement Fix:** Apply the necessary code changes to `dashboard_enhanced_v2.py` to ensure the summary data is fetched and displayed correctly. This might involve fixing error handling, adjusting parsing, or addressing cache interactions.
-   [ ] **Verify Fix:** Run the dashboard and confirm the "Run Summary" section now displays the correct numeric values.

## 4. Notes / Logs

*(Add logs during debugging)*